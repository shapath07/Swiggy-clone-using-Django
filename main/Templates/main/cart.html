{% extends 'main/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="{% static 'css/orders.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}



<div class="container my-5">
  <div class="text-center mb-5">
    <h2 class="fw-bold">Your cart</h2>
    <p class="text-secondary">All your cravings, beautifully organized üçî</p>
  </div>

  {% if orders %}
    <div class="row g-4">
      {% for order in orders %}
      <div class="col-12">
        <div class="card order-card p-3 shadow-sm border-0 rounded-4 d-flex flex-row align-items-center">
          
          <div class="order-image me-4">
            {% if order.product.image %}
              <img src="{{ order.product.image.url }}" alt="{{ order.product.name }}" class="img-fluid rounded-4" style="width: 200px; height: 150px; object-fit: cover;">
            {% else %}
              <img src="https://via.placeholder.com/200x150?text=No+Image" alt="No Image" class="img-fluid rounded-4">
            {% endif %}
          </div>

          <div class="order-info flex-grow-1">
            <div class="d-flex justify-content-between align-items-center">
              <h4 class="fw-semibold mb-1">{{ order.product.name }}</h4>
              <span class="badge bg-light text-dark border">
                {{ order.date|date:"M d, Y H:i" }}
              </span>
            </div>

            <p class="text-muted small mb-2">{{ order.product.description|truncatewords:25 }}</p>

            <ul class="list-unstyled mb-3">
              <li><strong>Quantity:</strong> {{ order.quantity }}</li>
              <li><strong>Price per unit:</strong> ‚Çπ{{ order.product.price }}</li>
              <li class="text-success fw-bold">
                Total: ‚Çπ{{ order.total_price }}
              </li>
            </ul>
            
                <div class="d-flex justify-content-between align-items-center">
                  <!-- Cancel Form -->
                  <form method="POST" action="{% url 'cancel_order' order.id %}" class="d-flex align-items-center">
                    {% csrf_token %}
                    <div class="input-group input-group-sm me-2" style="max-width: 150px;">
                      <span class="input-group-text">Qty</span>
                      <input type="number" name="quantity" min="1" value="1" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-danger btn-sm rounded-pill" onclick="return confirm('Cancel this item?')">
                      Cancel
                    </button>
                  </form>

                  <!-- View Details Button -->
                  <a href="{% url 'details' order.product.name %}" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                    View Details
                  </a>
                </div>
          </div>

        </div>
      </div>
      {% endfor %}
    </div>
    
   <div class="bill-container mt-5">
    {% if coupon_applied %}
      <p><strong>Original Bill:</strong> ‚Çπ{{ total_bill }}</p>
      <p><strong>Discounted Bill:</strong> <span class="text-success fw-bold">‚Çπ{{ amount_to_paid }}</span></p>
    {% else %}
      <p><strong>Your Bill:</strong> ‚Çπ{{ amount_to_paid }}</p>
    {% endif %}

     <form method="POST" action="{% url 'coupon' %}" class="coupon">
      {% csrf_token %}
       <label for="coupon_code">Enter valid code</label>
       <input type="text" id="coupon_code" name="coupon" required>
       <button type="submit">Apply Coupon</button>
     </form>
   </div>
   <form method="POST" action="{% url 'place_order' %}" class="text-end mt-4">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-outline-primary rounded-pill px-4">
            Place Order
          </button>
   </form>


  {% else %}
    <div class="text-center mt-5">
      <p class="text-secondary fs-5">You haven‚Äôt placed any orders yet üçï</p>
    </div>
  {% endif %}
</div>
{% endblock %}
